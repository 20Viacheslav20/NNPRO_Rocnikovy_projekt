<br/>
<div class="toolbar">
  <div class="actions">
    <button mat-stroked-button (click)="create()">New ticket</button>
    <button mat-stroked-button (click)="exportCsv()">Export CSV</button>
    <button mat-stroked-button (click)="generate()">Generate</button>
  </div>

  <div class="filters">
    <mat-form-field appearance="outline">
      <mat-label>Search</mat-label>
      <input matInput [(ngModel)]="search" placeholder="id or title">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Type</mat-label>
      <mat-select [(ngModel)]="typeFilter">
        <mat-option value="">All</mat-option>
        <mat-option value="BUG">BUG</mat-option>
        <mat-option value="FEATURE">FEATURE</mat-option>
        <mat-option value="TASK">TASK</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Priority</mat-label>
      <mat-select [(ngModel)]="priorityFilter">
        <mat-option value="">All</mat-option>
        <mat-option value="LOW">LOW</mat-option>
        <mat-option value="MEDIUM">MEDIUM</mat-option>
        <mat-option value="HIGH">HIGH</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>State</mat-label>
      <mat-select [(ngModel)]="stateFilter">
        <mat-option value="">All</mat-option>
        <mat-option value="OPEN">OPEN</mat-option>
        <mat-option value="IN_PROGRESS">IN PROGRESS</mat-option>
        <mat-option value="DONE">DONE</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</div>

<table mat-table [dataSource]="filtered()" class="mat-elevation-z2 full-width">

  <!-- ID -->
  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef>ID</th>
    <td mat-cell *matCellDef="let row">{{ row.id }}</td>
  </ng-container>

  <!-- Title -->
  <ng-container matColumnDef="title">
    <th mat-header-cell *matHeaderCellDef>Title</th>
    <td mat-cell *matCellDef="let row">{{ row.title }}</td>
  </ng-container>

  <ng-container matColumnDef="type">
    <th mat-header-cell *matHeaderCellDef>Type</th>
    <td mat-cell *matCellDef="let row">
      <span class="chip" [class]="typeClass(row.type)">
        {{ row.type }}
      </span>
    </td>
  </ng-container>

  <ng-container matColumnDef="priority">
    <th mat-header-cell *matHeaderCellDef>Priority</th>
    <td mat-cell *matCellDef="let row">
      <span class="chip" [class]="priorityClass(row.priority)">
        {{ row.priority }}
      </span>
    </td>
  </ng-container>

  <ng-container matColumnDef="state">
    <th mat-header-cell *matHeaderCellDef>State</th>
    <td mat-cell *matCellDef="let row">
      <span class="chip" [class]="stateClass(row.state)">
        {{ row.state }}
      </span>
    </td>
  </ng-container>


  <!-- UpdatedAt -->
  <ng-container matColumnDef="updatedAt">
    <th mat-header-cell *matHeaderCellDef>Updated</th>
    <td mat-cell *matCellDef="let row">
      {{ row.updatedAt | dateTime }}
    </td>
  </ng-container>

  <!-- Assignee -->
  <ng-container matColumnDef="assignee">
    <th mat-header-cell *matHeaderCellDef>Assignee</th>
    <td mat-cell *matCellDef="let row">
      {{ row.assigneeId ?? '-' }}
    </td>
  </ng-container>

  <!-- Actions -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef class="center">Actions</th>
    <td mat-cell *matCellDef="let row" class="center">
      <button mat-icon-button color="primary" (click)="view(row)" title="View">
        <mat-icon>open_in_new</mat-icon>
      </button>
      <button mat-icon-button color="accent" (click)="edit(row)" title="Edit">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="warn" (click)="remove(row)" [disabled]="saving" title="Delete">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

  <!-- Header and row templates -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

</table>
